<root main_tree_to_execute="MainTree">
  <BehaviorTree ID="MainTree">

    <Fallback name="NavigateWithRecovery">

      <!-- Main Spiral Coverage Plan -->
      <Sequence name="SpiralSTC_Main">
        <ComputePathToPose goal="{coverage_goal}" path="{spiral_path}" planner_id="SpiralSTC"/>
        <FollowPath path="{spiral_path}" controller_id="FollowPath"/>
      </Sequence>

      <!-- Recovery Branch if Blocked -->
      <Sequence name="RecoveryIfBlocked">
        <GetRobotPose output="{current_pose}"/>
        <FindUnoccupiedWaypoint path="{spiral_path}" pose="{current_pose}" output="{rejoin_point}"/>
        <ComputePathToPose goal="{rejoin_point}" path="{recovery_path}" planner_id="GridBased"/>
        <FollowPath path="{recovery_path}" controller_id="FollowPath"/>
      </Sequence>

    </Fallback>

  </BehaviorTree>
</root>
